/*! staging.betuniq.com 2013-11-11 */
(function(){var Q,root,_ref;root=this,Q=null!=root.Q?root.Q:root.Q={},Q.paths={base:location.host+"/qoffice/",initPaths:function(){var a,b;return this.baseit=location.host+"it/qoffice/",this.sortStampaquoteSports=this.base+"api/rest/sortFrontendSports",a=location.href.substring(this.baseit.length-1),b=location.pathname.substring(1).split("/"),this.realm=b[1]||(b[1]=""),this.model=b[2]||(b[2]=""),this.currentpage=b[3]||(b[3]=""),this.assets="/bundles/qoffice/images/",delete this.initPaths,this}}.initPaths(),modulejs.define("Q",function(){return Q}),modulejs.define("jquery",function(){return jQuery}),modulejs.define("Backbone",function(){return Backbone}),modulejs.define("_",function(){return _}),Backbone.View.prototype.close=function(){return this.remove(),this.unbind(),this.onClose?this.onClose():void 0},modulejs.define("ModelAccounts",["Backbone"],function(a){var b;return b=a.Model.extend({idAttribute:"uid",defaults:{qid:"",nome:"",cognome:"",datacreazione:"",accounts:{ragione:""},callcenter:[],indirizzo:"",comune:"",provincia:"",regione:"",paese:"",status:"",profilo:"",stato:"",telefono:"",uid:"",padre:{idutente:"",uid:""},latlng:{idref:"",lat:"",lng:""},active:!1,visibleInMaps:!0}})}),modulejs.define("ModelFoglinotizia",["Backbone"],function(a){var b;return b=a.Model.extend({defaults:{id:"",master:"",ragione:"",nome:"",cognome:"",indirizzo:"",comune:"",provincia:"",regione:"",paese:"",status:"",created_at:"",apertura:"",email:"",telefono:"",note:"",lat:"",lng:"",active:!1}})}),modulejs.define("CollectionAccounts",["Q","Backbone","ModelAccounts"],function(a,b,c){var d;return d=b.Collection.extend({model:c,url:location.origin+"/qoffice/api/accounts/lista/"+a.paths.currentpage,initialize:function(){this.fetch({reset:!0})}})}),modulejs.define("CollectionFoglinotizia",["Q","Backbone","ModelFoglinotizia"],function(a,b,c){var d;return d=b.Collection.extend({model:c,url:location.origin+"/qoffice/api/accounts/lista/"+a.paths.currentpage,initialize:function(){this.fetch({reset:!0})}})}),modulejs.define("ViewPartialsFactory",["Q","jquery","Backbone"],function(a,b,c){var d;return d=c.View.extend({init:function(a){null==a&&(a=!1),_.bindAll(this,"render"),this.ajaxUrl=this.setAjaxUrl(),this.loaded=a,this.tempModel=this.options.model.clone(),this.appendMenuItem()},setAjaxUrl:function(){return a.Accounts.paths.api+"partial/"+this.options.name+"/"+this.options.model.id},appendMenuItem:function(){var a,c,d=this;return c=document.createDocumentFragment(),a=document.createElement("li"),a.className="accounts-partials-"+this.options.name+"-menutab "+(this.loaded?"active":void 0),a.innerHTML='<a href="#tab-'+this.options.name+"-"+this.model.get("uid")+'" data-toggle="tab"></span> <i class="fontello-icon-accounts-'+this.options.name+'"></i> '+this.options.name+"</a>",c.appendChild(a),this.options.mainView.find(".nav-tabs").append(c),this.options.mainView.delegate(".accounts-partials-"+this.options.name+"-menutab","click",function(a){return b(a.currentTarget).hasClass("active")||d.loaded?void 0:(d.loaded=!0,d.fetchData())}),this.loaded?this.fetchData():void 0},fetchData:function(){var a;a=this,b.ajax({url:this.ajaxUrl,async:!1,success:function(b){return a.$el.detach(),a.appendTo(JSON.parse(b))}})},appendTo:function(a){this.options.mainView.find(".tab-content").append(a.tab),this.createTemplate()},createTemplate:function(){this.$el=this.options.mainView.find("#tab-"+this.options.name+"-"+this.options.model.id),this.$el.addClass(this.loaded?"active":""),this.templateTab=_.template(this.$el.find(".template-tab-"+this.options.name).html()),this.render(),this.delegateEvents()}})}),modulejs.define("ViewPartialsAssegni",["Q","jquery","ViewPartialsFactory"],function(a,b,c){var d;return d=c.extend({initialize:function(){return this.init(this.options.active)},setAjaxUrl:function(){return a.Accounts.paths.api+"partial/"+this.options.name+"/"+this.options.model.id+"/"+a.paths.currentpage},render:function(){var a;return a=this,this.$el.children("div").html(this.templateTab({account:this.options.model.toJSON()})),this.$el.find(".fileupload").each(function(){return b(this).fileupload({maxFileSize:3145728,limitMultiFileUploads:5,acceptFileTypes:/(\.|\/)(pdf|docx|doc|rtf|txt|gif|jpe?g|png)$/i,submit:function(){a.loaded=!1}})}),this.$el.on("click",".accounts-elimina-file",function(a){return a.preventDefault(),confirm("Sei sicuro?")?(b(a.currentTarget).parents("li").detach(),b.ajax({url:b(a.currentTarget).attr("href"),type:"DELETE",success:function(){}})):!1}),this}})}),modulejs.define("ViewPartialsCallcenter",["Q","jquery","ViewPartialsFactory"],function(a,b,c){var d;return d=c.extend({events:{"click .openModal":"openModal"},initialize:function(){return this.init(this.options.active)},render:function(){this.$el.html(this.templateTab({account:this.options.model.toJSON()})),this.renderDataTable()},renderDataTable:function(){this.table=this.$el.find("#datatable-account-"+this.options.model.get("idutente")+"-callcenter").dataTable({aLengthMenu:[[20,50,100,-1],[20,50,100,"All"]],iDisplayLength:20,aaData:this.model.toJSON().callcenter,bDeferRender:!0,bRetrieve:!0,bIgnoreEmpty:!1,oColumnFilterWidgets:{aiExclude:[0]},aoColumns:function(){var a;return a=[{mData:function(a){return'<a class="btn btn-mini btn-yellow openModal" data-toggle="modal" rel="'+a.id+"-"+a.idutente+'" href="#'+a.id+'"><i class="fontello-icon-accounts-callcenter"></i>modifica</a>'}},{mData:function(a){return a.dataora}},{mData:function(a){return a.user.username}},{mData:function(a){var b,c;return a.esito?(c=a.esito,b="Positivo"===a.esito?"success":"important"):(b="warning",c="manca esito"),"<span class='label label-"+b+"' />"+c+"</span>"}},{mData:function(a){return a.descrizione?a.descrizione:""}}]}(),oLanguage:{sInfoEmpty:"0 record trovati",sInfoFiltered:"(filtrati su un totale di _MAX_)",sInfo:"Visualizzi da _START_ a _END_ di _TOTAL_ totali",sSearch:"Global search: ",sLengthMenu:"Mostra _MENU_ risultati",sZeroRecords:"Nessun record trovato"},bSortCellsTop:!0,aaSorting:[[1,"desc"]],sDom:"<'row-fluid' <'widget-header' <'span4'l> <'span8'<'table-tool-wrapper'><'table-tool-container'>> > > rti <'row-fluid' <'widget-footer' <'span6' <'table-action-wrapper'>> <'span6'p> >>"}).columnFilter({sPlaceHolder:"head:after"})},openModal:function(c){var d,e;d=this,e=this.$el.find(".ajaxModalTarget"),b(".ajaxModalTarget").empty(),b("body").modalmanager("loading"),e.load(a.Accounts.paths.api+this.options.name+"/"+b(c.currentTarget).attr("rel"),"",function(){e.modal().css({"margin-top":"0px"}),b("body").delegate(".ajaxModalSave","click",function(a){return d.saveDataFromModal(a)})})},saveDataFromModal:function(c){var d,e;b("body").undelegate(".ajaxModalSave","click"),d=this,e=b(c.currentTarget).parents(".ajaxModalTarget"),e.modal("loading"),setTimeout(function(){b.ajax({url:a.Accounts.paths.api+d.options.name,type:"POST",data:e.find("form").serialize(),success:function(a){var e;e=JSON.parse(a).saved,e&&(b(c.currentTarget).siblings(".close").click(),d.addOrModifyItem(e))}})},100)},addOrModifyItem:function(a){var b,c;return b=this.options.model.get(this.options.name),c=_.reject(b,function(b){return b.id===a.id}),c.push(a),this.options.model.set(this.options.name,c),this.refreshTable()},refreshTable:function(){var a;a=this.table.fnSettings(),a.aaData=this.options.model.attributes.callcenter,this.table.fnReloadAjax(a)}})}),modulejs.define("ViewPartialsDocumenti",["Q","jquery","ViewPartialsFactory"],function(a,b,c){var d;return d=c.extend({initialize:function(){return this.init(this.options.active)},setAjaxUrl:function(){return a.Accounts.paths.api+"partial/"+this.options.name+"/"+this.options.model.id+"/"+a.paths.currentpage},render:function(){var a;return a=this,this.$el.children("div").html(this.templateTab({account:this.options.model.toJSON()})),this.$el.find(".fileupload").each(function(){return b(this).fileupload({maxFileSize:2e6,limitMultiFileUploads:5,acceptFileTypes:/(\.|\/)(pdf|docx|doc|rtf|txt|gif|jpe?g|png)$/i,submit:function(){return a.loaded=!1,!0}})}),this.$el.on("click",".accounts-elimina-file",function(a){return a.preventDefault(),confirm("Sei sicuro?")?(b(a.currentTarget).parents("li").detach(),b.ajax({url:b(a.currentTarget).attr("href"),type:"DELETE",success:function(){}})):!1}),this}})}),modulejs.define("ViewPartialsGallery",["Q","jquery","ViewPartialsFactory"],function(a,b,c){var d;return d=c.extend({initialize:function(){return this.init(this.options.active)},setAjaxUrl:function(){return a.Accounts.paths.api+"partial/"+this.options.name+"/"+this.options.model.id+"/"+a.paths.currentpage},render:function(){var a;return a=this,this.$el.children("div").html(this.templateTab({account:this.options.model.toJSON()})),this.$el.find(".fileupload").each(function(){return b(this).fileupload({maxFileSize:3145728,limitMultiFileUploads:5,acceptFileTypes:/(\.|\/)(pdf|docx|doc|rtf|txt|gif|jpe?g|png)$/i,submit:function(){a.loaded=!1}})}),this.$el.on("click",".accounts-elimina-file",function(a){return a.preventDefault(),confirm("Sei sicuro?")?(b(a.currentTarget).parents("li").detach(),b.ajax({url:b(a.currentTarget).attr("href"),type:"DELETE",success:function(){}})):!1}),this}})}),modulejs.define("ViewPartialsIsolutions",["Q","ViewPartialsFactory"],function(a,b){var c;return c=b.extend({initialize:function(){return this.init(this.options.active)},setAjaxUrl:function(){return a.Accounts.paths.api+"partial/"+this.options.name+"/"+this.options.model.id+"/"+a.paths.currentpage},render:function(){return this.$el.html(this.templateTab({account:this.options.model.toJSON()})),this}})}),modulejs.define("ViewPartialsQpoints",["Q","jquery","ViewPartialsFactory"],function(a,b,c){var d;return d=c.extend({initialize:function(){return this.init(this.options.active)},events:{"click .openModal":"openModal"},render:function(){this.$el.html(this.templateTab({account:this.options.model.toJSON(),lastMovement:this.options.model.get("qpoints")[0]})),this.renderDataTable()},renderDataTable:function(){return this.table=this.$el.find("#datatable-account-"+this.options.model.get("idutente")+"-qpoints").dataTable({aLengthMenu:[[20,50,100,-1],[20,50,100,"All"]],iDisplayLength:20,aaData:this.model.toJSON().qpoints,bDeferRender:!0,bRetrieve:!0,bIgnoreEmpty:!1,oColumnFilterWidgets:{aiExclude:[0]},aoColumns:function(){var a;return a=[{mData:function(a){return'<a class="btn btn-mini btn-yellow openModal" data-toggle="modal" rel="'+a.idtransazione+"-"+a.idutente+'" href="#'+a.idtransazione+'"><i class="fontello-icon-accounts-qpoints"></i>modifica</a>'}},{mData:function(a){return a.dataora}},{mData:function(a){return a.operatore.username}},{mData:function(a){var b,c;return a.causali?(c=a.causali.descrizione,b="2"===a.causali.idcausale?"success":"info"):(b="important",c="manca causale"),"<span class='label label-"+b+"' />"+c+"</span>"}},{mData:function(a){return a.movimenti}},{mData:function(a){return a.saldo}},{mData:function(a){return a.descrizione?a.descrizione:""}}]}(),oLanguage:{sInfoEmpty:"0 record trovati",sInfoFiltered:"(filtrati su un totale di _MAX_)",sInfo:"Visualizzi da _START_ a _END_ di _TOTAL_ totali",sSearch:"Global search: ",sLengthMenu:"Mostra _MENU_ risultati",sZeroRecords:"Nessun record trovato"},bSortCellsTop:!0,aaSorting:[[1,"desc"]],sDom:"<'row-fluid' <'widget-header' <'span4'l> <'span8'<'table-tool-wrapper'><'table-tool-container'>> > > rti <'row-fluid' <'widget-footer' <'span6' <'table-action-wrapper'>> <'span6'p> >>"}).columnFilter({sPlaceHolder:"head:after"})},openModal:function(c){var d,e;d=this,e=this.$el.find(".ajaxModalTarget"),b(".ajaxModalTarget").empty(),b("body").modalmanager("loading"),e.load(a.Accounts.paths.api+this.options.name+"/"+b(c.currentTarget).attr("rel"),"",function(){e.modal().css({"margin-top":"0px"}),b("body").delegate(".ajaxModalSave","click",function(a){return d.saveDataFromModal(a)})})},saveDataFromModal:function(c){var d,e;b("body").undelegate(".ajaxModalSave","click"),d=this,e=b(c.currentTarget).parents(".ajaxModalTarget"),e.modal("loading"),setTimeout(function(){b.ajax({url:a.Accounts.paths.api+d.options.name,type:"POST",data:e.find("form").serialize(),success:function(a){var e;e=JSON.parse(a).saved,e&&(b(c.currentTarget).siblings(".close").click(),d.addOrModifyItem(e))}})},100)},addOrModifyItem:function(a){var b,c,d;return b=this.options.model.get(this.options.name),d=_.reject(b,function(b){return b.idtransazione===a.idtransazione}),c=b.length>d.length,d.push(a),this.options.model.set(this.options.name,d),c||this.updateUIAttuali(a),this.refreshTable()},refreshTable:function(){var a;a=this.table.fnSettings(),a.aaData=this.options.model.attributes[this.options.name],this.table.fnReloadAjax(a)},updateUIAttuali:function(a){var b,c,d;c=a.movimenti>0,d=this.$el.find(".statistic-values"),d.find("span.balance").html(a.saldo),b=this.$el.find(".movement"),b.removeClass("positive negative").addClass("movement "+(c?"positive":"negative")),b.find(".indicator").removeClass("fontello-icon-up-dir fontello-icon-down-dir").addClass(c?"fontello-icon-up-dir":"fontello-icon-down-dir"),b.find("sup").html(a.movimenti)}})}),modulejs.define("ViewPartialsQshop",["Q","jquery","ViewPartialsFactory"],function(a,b,c){var d;return d=c.extend({initialize:function(){return this.init(this.options.active)},events:{"click .openModal":"openModal"},render:function(){this.$el.html(this.templateTab({account:this.options.model.toJSON()})),this.renderDataTable()},renderDataTable:function(){return this.table=this.$el.find("#datatable-account-"+this.options.model.get("idutente")+"-qshop").dataTable({aLengthMenu:[[20,50,100,-1],[20,50,100,"All"]],iDisplayLength:20,aaData:this.model.toJSON().qshop,bDeferRender:!0,bRetrieve:!0,bIgnoreEmpty:!1,oColumnFilterWidgets:{aiExclude:[0]},aoColumns:function(){var a;return a=[{mData:function(a){return'<a class="btn btn-mini btn-yellow openModal" data-toggle="modal" rel="'+a.idtransazione+"-"+a.idutente+'" href="#'+a.idtransazione+'"><i class="fontello-icon-accounts-qshop"></i>modifica</a>'}},{mData:function(a){return a.dataora}},{mData:function(a){return a.operatore.username}},{mData:function(a){var b,c;return a.causali?(c=a.causali.descrizione,b="2"===a.causali.idcausale?"success":"info"):(b="important",c="manca causale"),"<span class='label label-"+b+"' />"+c+"</span>"}},{mData:function(a){return a.movimenti}},{mData:function(a){return a.saldo}},{mData:function(a){return a.descrizione?a.descrizione:""}}]}(),oLanguage:{sInfoEmpty:"0 record trovati",sInfoFiltered:"(filtrati su un totale di _MAX_)",sInfo:"Visualizzi da _START_ a _END_ di _TOTAL_ totali",sSearch:"Global search: ",sLengthMenu:"Mostra _MENU_ risultati",sZeroRecords:"Nessun record trovato"},bSortCellsTop:!0,aaSorting:[[1,"desc"]],sDom:"<'row-fluid' <'widget-header' <'span4'l> <'span8'<'table-tool-wrapper'><'table-tool-container'>> > > rti <'row-fluid' <'widget-footer' <'span6' <'table-action-wrapper'>> <'span6'p> >>"}).columnFilter({sPlaceHolder:"head:after"})},openModal:function(c){var d,e;d=this,e=this.$el.find(".ajaxModalTarget"),b(".ajaxModalTarget").empty(),b("body").modalmanager("loading"),e.load(a.Accounts.paths.api+this.options.name+"/"+b(c.currentTarget).attr("rel"),"",function(){e.modal().css({"margin-top":"0px"}),b("body").delegate(".ajaxModalSave","click",function(a){return d.saveDataFromModal(a)})})},saveDataFromModal:function(c){var d,e;b("body").undelegate(".ajaxModalSave","click"),d=this,e=b(c.currentTarget).parents(".ajaxModalTarget"),e.modal("loading"),setTimeout(function(){b.ajax({url:a.Accounts.paths.api+d.options.name,type:"POST",data:e.find("form").serialize(),success:function(a){var e;e=JSON.parse(a).saved,e&&(b(c.currentTarget).siblings(".close").click(),d.addOrModifyItem(e))}})},100)},addOrModifyItem:function(a){var b,c,d;return b=this.options.model.get(this.options.name),d=_.reject(b,function(b){return b.idtransazione===a.idtransazione}),c=b.length>d.length,d.push(a),this.options.model.set(this.options.name,d),c||this.updateUIAttuali(a),this.refreshTable()},refreshTable:function(){var a;a=this.table.fnSettings(),a.aaData=this.options.model.attributes[this.options.name],this.table.fnReloadAjax(a)},updateUIAttuali:function(a){var b,c,d;c=a.movimenti>0,d=this.$el.find(".statistic-values"),d.find("span.balance").html(a.saldo),b=this.$el.find(".movement"),b.removeClass("positive negative").addClass("movement "+(c?"positive":"negative")),b.find(".indicator").removeClass("fontello-icon-up-dir fontello-icon-down-dir").addClass(c?"fontello-icon-up-dir":"fontello-icon-down-dir"),b.find("sup").html(a.movimenti)}})}),modulejs.define("ViewPartialsScheda",["Q","jquery","ViewPartialsFactory"],function(a,b,c){var d;return d=c.extend({events:{"change input":"inputIsChanged","click button":"inputIsChanged","click input[type='submit']":"save"},initialize:function(){return this.init(this.options.active)},setAjaxUrl:function(){return a.Accounts.paths.api+"partial/"+this.options.name+"/"+this.options.model.id+"/"+a.paths.currentpage},render:function(){return this.$el.html(this.templateTab({account:this.options.model.toJSON()})),this},save:function(c){var d;c.preventDefault(),d=this,b.ajax({url:a.Accounts.paths.api+"salva/"+a.paths.currentpage+"/"+this.options.name,type:"POST",dataType:"html",async:!1,data:this.$el.find("form").serialize(),beforeSend:function(){return d.$el.removeClass("active")},success:function(a){JSON.parse(a).saved&&(d.$el.addClass("active in"),d.modelIsSaved())}})},showMap:function(){var a,b,c,d;return a=this.model.toJSON(),0===a.latlng.lat.length?!1:(c={center:new google.maps.LatLng(a.latlng.lat,a.latlng.lng),zoom:15,mapTypeId:google.maps.MapTypeId.ROADMAP},b=new google.maps.Map(document.getElementById("usermap"),c),d=new google.maps.Marker({position:new google.maps.LatLng(a.latlng.lat,a.latlng.lng),map:b,title:a.ragione,clickable:!0}),d.info=new google.maps.InfoWindow({content:"<div><h4>"+a.ragione+"</h4><p><small>Riferimento: </small><strong>"+a.nome+" "+a.cognome+"</strong></p><p><small>Master: </small>"+a.master+"</p></div>"}),google.maps.event.addListener(d,"click",function(){return this.info.open(b,this)}),d.setMap(b))},inputIsChanged:function(a){this.tempModel.attributes.accounts[a.currentTarget.name]=a.currentTarget.value},modelIsSaved:function(){return this.model.set(this.tempModel.attributes),this.model.trigger("saved")}})}),modulejs.define("ViewAccounts",["Q","jquery","Backbone","ViewSchedaEdit","ViewTabMenuSchede"],function(a,b,c,d,e){var f;return f=c.View.extend({events:{"click .aprischeda":"openAccountTabScheda"},initialize:function(){_.bindAll(this,"render","addMapButton","mapView","renderInMap"),this.listenTo(this.collection,{reset:function(){return this.renderDataTable()}}),this.TabMenu=new e({collection:this.collection})},render:function(){return this.renderDataTable(),this},renderDataTable:function(){var c;return c=this,this.OdataTable=b(this.el).dataTable({aLengthMenu:[[20,50,100,-1],[20,50,100,"All"]],iDisplayLength:20,aaData:this.collection.toJSON(),bDeferRender:!1,bRetrieve:!0,bIgnoreEmpty:!1,oColumnFilterWidgets:{aiExclude:[1]},aoColumns:function(){var b;return b=[{mData:function(b){var c,d,e,f,g,h,i,j,k;return e="",("developer"===a.paths.realm||"amministrazione"===a.paths.realm)&&(c="Agente"===b.accounts.tipoutente?'active" style="opacity:0.2"':'"',d="Agenzia"===b.accounts.tipoutente?'active" style="opacity:0.2"':'"',k="Utente"===b.accounts.tipoutente?'active" style="opacity:0.2"':'"',j="Poker"===b.accounts.tipoutente?'active" style="opacity:0.2"':'"',"si"===b.accounts.nascosto?(g='active" style="opacity:0.3"',h="nascosto",i="no"):(g='"',h="nascondi",i="si"),f="si"===b.accounts.nascosto?"<span class=>nascosto</span>":"<span>nascondi</span>",e=' <a target="_blank" class="btn btn-mini btn-turgu '+c+' href="'+(a.Accounts.paths.api+"tipoaccount/Agente/"+b.idutente)+'">Agente</a> '+' <a target="_blank" class="btn btn-mini btn-orange '+d+' href="'+a.Accounts.paths.api+"tipoaccount/Agenzia/"+b.idutente+'">Agenzia</a> '+' <a target="_blank" class="btn btn-mini btn-black '+k+' href="'+a.Accounts.paths.api+"tipoaccount/Utente/"+b.idutente+'">Utente</a> '+' <a target="_blank" class="btn btn-mini btn-boo '+j+' href="'+a.Accounts.paths.api+"tipoaccount/Poker/"+b.idutente+'">Poker</a> '+'<a target="_blank" class="btn btn-mini btn-red '+g+' href="'+a.Accounts.paths.api+"nascosto/"+i+"/"+b.idutente+'">'+h+"</a>"),'<a class="btn btn-mini btn-yellow aprischeda" rel="'+("undefined"!=typeof b.uid?b.uid:b.ragione)+'" href="#'+b.uid+'"><i class="fontello-icon-accounts-scheda"></i>Vedi</a>'+e}},{mData:function(a){return a.idutente}},{mData:function(a){return a.uid}},{mData:function(a){return a.padre.uid}},{mData:function(a){return a.accounts.ragione}},{mData:function(a){return a.nome}},{mData:function(a){return a.cognome}},{mData:function(a){return"undefined"!=typeof a.accounts.comune?a.accounts.comune:a.citta}},{mData:function(a){return"undefined"!=typeof a.accounts.provincia?a.accounts.provincia:a.provincia}},{mData:function(a){return"undefined"!=typeof a.accounts.regione?a.accounts.regione:a.regione}},{mData:function(a){return a.accounts.qshop}}]}(),oLanguage:{sInfoEmpty:"0 record trovati",sInfoFiltered:"(filtrati su un totale di _MAX_)",sInfo:"Visualizzi da _START_ a _END_ di _TOTAL_ totali",sSearch:"Global search: ",sLengthMenu:"Mostra _MENU_ risultati",sZeroRecords:"Nessun record trovato"},bSortCellsTop:!0,aaSorting:[[2,"asc"]],sDom:"<'row-fluid' <'widget-header' <'span4'l> <'span8'<'table-tool-wrapper'><'table-tool-container'>> > > rti <'row-fluid' <'widget-footer' <'span6' <'table-action-wrapper'>> <'span6'p> >>",fnDrawCallback:function(a){return c.renderInMap(a)}}).columnFilter({sPlaceHolder:"head:after"}),this.addMapButton()},renderInMap:function(a){var b,c,d,e,f;if(this.OdataTable){for(this.collection.forEach(function(a){a.set("visibleInMaps",!1)}),f=a.aiDisplay,d=0,e=f.length;e>d;d++)b=f[d],c=this.OdataTable.fnGetData(b),c=this.collection.get(c.uid),c.set({visibleInMaps:!0});this.mapView()}},updateDataTable:function(){this.OdataTable.fnSettings().aaData=this.collection.toJSON(),this.OdataTable.fnReloadAjax(this.OdataTable.fnSettings())},openAccountTabScheda:function(c,e){var f,g,h;return c.currentTarget?f=g=b(c.currentTarget).attr("href").slice(1):g=c,h="tabScheda-"+g,null!=a.Accounts.Instances[h]?(a.Accounts.Instances[h].view.setActive(),void 0):(a.Accounts.Instances[h]={view:new d({el:"#"+h,uid:g,viewAccounts:this,collection:this.collection,tabActive:e})},void 0)},addMapButton:function(){var c;c=this,b("#lista-"+a.paths.currentpage+"_wrapper .table-action-wrapper").html('<a href="#tabMappa" data-toggle="tab" class="btn aprilistainmappa"><i class="fontello-icon-map"></i>Apri nella mappa</a>').find(".aprilistainmappa").on("click",function(){return b(b(this).attr("href")).fadeIn(),c.mapView(),b("body").delegate(".apri-scheda-da-mappa","click",function(a){return a.preventDefault(),c.openAccountTabScheda(a)})})},mapView:function(){var c,d,e,f,g,h,i,j,k;for(e=document.getElementById("map-canvas-"+a.paths.currentpage),h={center:new google.maps.LatLng(41.871,12.567),zoom:6,mapTypeId:google.maps.MapTypeId.ROADMAP},g=new google.maps.Map(e,h),d=this.collection.filter(function(a){return a.get("visibleInMaps")===!0&&""!==a.get("latlng").idref}),b(".mappa-accounts-valid span").html(d.length),j=0,k=d.length;k>j;j++)c=d[j],""!==c.get("latlng").idref&&(f="si"===c.get("accounts").qshop?"qshop":a.paths.currentpage,i=new google.maps.Marker({position:new google.maps.LatLng(c.get("latlng").lat,c.get("latlng").lng),map:g,icon:a.paths.assets+"q-marker-"+f+".png",title:c.get("accounts").ragione,clickable:!0})),i.info=new google.maps.InfoWindow({content:"<div><h4>"+c.get("accounts").ragione+"</h4><p><small>Riferimento: </small><strong>"+c.get("nome")+" "+c.get("cognome")+"</strong></p><p><small>Master: </small>"+c.get("master")+'</p><p><a href="mailto:'+c.get("email")+'">'+c.get("email")+"</a></p></div>"+'<p><a class="apri-scheda-da-mappa" rel="'+c.get("uid")+'" href="#'+c.get("uid")+'">Apri scheda</a></p>'+"</div>"}),google.maps.event.addListener(i,"click",function(){return this.info.open(g,this)}),i.setMap(g);return window.scrollTo(0,b("#tabMappa").position().top-80)}})}),modulejs.define("ViewFoglinotizia",["Q","jquery","Backbone"],function(a,b,c){var d;return d=c.View.extend({events:{"click .aprischeda":"handleScheda"},initialize:function(){_.bindAll(this,"render","mapButton","mapView"),this.collection.bind("reset",this.render,this)},render:function(){return this.dataTable(),this},dataTable:function(){var c;return c=this,this.OdataTable=b(this.el).dataTable({aLengthMenu:[[20,50,100,-1],[20,50,100,"All"]],iDisplayLength:20,aaData:this.collection.toJSON(),bDeferRender:!0,bRetrieve:!0,bIgnoreEmpty:!1,oColumnFilterWidgets:{aiExclude:[1]},aoColumns:function(){var b;return b=[{mData:function(b){var c,d,e,f,g,h,i,j,k;return e="",("developer"===a.paths.realm||"amministrazione"===a.paths.realm)&&(c="Agente"===b.accounts.tipoutente?'active" style="opacity:0.2"':'"',d="Agenzia"===b.accounts.tipoutente?'active" style="opacity:0.2"':'"',k="Utente"===b.accounts.tipoutente?'active" style="opacity:0.2"':'"',j="Poker"===b.accounts.tipoutente?'active" style="opacity:0.2"':'"'),"si"===b.accounts.nascosto?(g='active" style="opacity:0.3"',h="nascosto",i="no"):(g='"',h="nascondi",i="si"),f="si"===b.accounts.nascosto?"<span class=>nascosto</span>":"<span>nascondi</span>",e=' <a target="_blank" class="btn btn-mini btn-turgu '+c+' href="'+a.Accounts.paths.api+"tipoaccount/Agente/"+b.idutente+'">Agente</a> '+' <a target="_blank" class="btn btn-mini btn-orange '+d+' href="'+a.Accounts.paths.api+"tipoaccount/Agenzia/"+b.idutente+'">Agenzia</a> '+' <a target="_blank" class="btn btn-mini btn-black '+k+' href="'+a.Accounts.paths.api+"tipoaccount/Utente/"+b.idutente+'">Utente</a> '+' <a target="_blank" class="btn btn-mini btn-boo '+j+' href="'+a.Accounts.paths.api+"tipoaccount/Poker/"+b.idutente+'">Poker</a> '+'<a target="_blank" class="btn btn-mini btn-red '+g+' href="'+a.Accounts.paths.api+"nascosto/"+i+"/"+b.idutente+'">'+h+"</a>"+'<a class="btn btn-mini btn-yellow aprischeda" rel="'+("undefined"!=typeof b.uid?b.uid:b.ragione)+'" href="#'+b.uid+'"><i class="fontello-icon-doc-1"></i>Vedi</a>'+e}},{mData:function(a){return a.uid}},{mData:function(a){return a.padre.uid}},{mData:function(a){return a.accounts.ragione}},{mData:function(a){return a.nome}},{mData:function(a){return a.cognome}},{mData:function(a){return"undefined"!=typeof a.accounts.comune?a.accounts.comune:a.citta}},{mData:function(a){return"undefined"!=typeof a.accounts.provincia?a.accounts.provincia:a.provincia}},{mData:function(a){return"undefined"!=typeof a.accounts.regione?a.accounts.regione:a.regione}},{mData:function(a){return a.statiutenteiso.statoutente}},{mData:function(a){return a.datacreazione}}]}(),oLanguage:{sInfoEmpty:"0 record trovati",sInfoFiltered:"(filtrati su un totale di _MAX_)",sInfo:"Visualizzi da _START_ a _END_ di _TOTAL_ totali",sSearch:"Global search: ",sLengthMenu:"Mostra _MENU_ risultati",sZeroRecords:"Nessun record trovato"},bSortCellsTop:!0,aaSorting:[[2,"asc"]],sDom:"<'row-fluid' <'widget-header' <'span4'l> <'span8'<'table-tool-wrapper'><'table-tool-container'>> > > rti <'row-fluid' <'widget-footer' <'span6' <'table-action-wrapper'>> <'span6'p> >>",fnDrawCallback:function(a){var b,d,e,f,g;if(c.OdataTable){for(c.collection.forEach(function(a){return a.set("visibleInMaps",!1)}),g=a.aiDisplay,e=0,f=g.length;f>e;e++)b=g[e],d=c.OdataTable.fnGetData(b),d=c.collection.get(d.uid),d.set({visibleInMaps:!0});return c.mapView()}}}).columnFilter({sPlaceHolder:"head:after"}),this.mapButton()},mapButton:function(){var c;return c=this,b("#lista-"+a.paths.currentpage+"_wrapper .table-action-wrapper").html('<a href="#tabMappa" data-toggle="tab" class="btn aprilistainmappa"><i class="fontello-icon-map"></i>Apri nella mappa</a>').find(".aprilistainmappa").on("click",function(){return b(b(this).attr("href")).fadeIn(),c.mapView(),b("body").delegate(".apri-scheda-da-mappa","click",function(a){return a.preventDefault(),c.handleScheda(a)})})},handleScheda:function(c){var d,e;return d=b(c.currentTarget).attr("href").slice(1),e="tabScheda-"+d,_.contains(a.Accounts.Instances,e)?(a.Accounts.Instances[e].load(),void 0):(a.Accounts.Instances.push(e),a.Accounts.Instances[e]=new a.Accounts.V.SchedaEdit({el:"#"+e,handlerId:d,handlerTabTitle:b(c.currentTarget).attr("rel"),tabellaView:this.OdataTable,collection:q.accounts.accountsCollection}))},mapView:function(){var c,d,e,f,g,h,i,j;for(e=document.getElementById("map-canvas-"+a.paths.currentpage),mapOptions({center:new google.maps.LatLng(41.871,12.567),zoom:6,mapTypeId:google.maps.MapTypeId.ROADMAP}),g=new google.maps.Map(e,mapOptions),d=this.collection.filter(function(a){return a.get("visibleInMaps")===!0&&""!==a.get("latlng").idref}),b(".mappa-accounts-valid span").html(d.length),i=0,j=d.length;j>i;i++)c=d[i],""!==c.get("latlng").idref&&(f="si"===c.get("accounts").qshop?"qshop":a.paths.currentpage,h=new google.maps.Marker({position:new google.maps.LatLng(c.get("latlng").lat,c.get("latlng").lng),map:g,icon:a.paths.assets+"q-marker-"+f+".png",title:c.get("accounts").ragione,clickable:!0})),h.info=new google.maps.InfoWindow({content:"<div><h4>"+c.get("accounts").ragione+"</h4><p><small>Riferimento: </small><strong>"+c.get("nome")+" "+c.get("cognome")+"</strong></p><p><small>Master: </small>"+c.get("master")+'</p><p><a href="mailto:'+c.get("email")+'">'+c.get("email")+"</a></p></div>"+'<p><a class="apri-scheda-da-mappa" rel="'+c.get("uid")+'" href="#'+c.get("uid")+'">Apri scheda</a></p>'+"</div>"}),google.maps.event.addListener(h,"click",function(){return this.info.open(g,this)}),h.setMap(g);return window.scrollTo(0,b("#tabMappa").position().top-80)}})}),modulejs.define("ViewSchedaEdit",["Q","jquery","Backbone","ViewPartialsAssegni","ViewPartialsCallcenter","ViewPartialsDocumenti","ViewPartialsGallery","ViewPartialsIsolutions","ViewPartialsQpoints","ViewPartialsQshop","ViewPartialsScheda"],function(Q,$,Backbone,ViewPartialsAssegni,ViewPartialsCallcenter,ViewPartialsDocumenti,ViewPartialsGallery,ViewPartialsIsolutions,ViewPartialsQpoints,ViewPartialsQshop,ViewPartialsScheda){var ViewSchedaEdit;return ViewSchedaEdit=Backbone.View.extend({partialsPrefix:"ViewPartials",initialize:function(){_.bindAll(this,"render","load","updateCollection"),this._setModelAndActiveIt(),this.listenTo(this.collection,{reset:function(){return this.updateCollection()}}),this.load()},_setModelAndActiveIt:function(){this.model=this.collection.get(this.options.uid),this.model.set({active:!0}),this.model.on({saved:this.updateCollection})},setActive:function(){this.options.viewAccounts.TabMenu.setTabSchedaAsActive(this.model.id),this.$el.siblings().removeClass("active in").end().addClass("active in")},loadPartials:function(){var c,fn,s,_i,_len,_ref;for(s=this,s.options.tabActive||(s.options.tabActive="scheda"),_ref=this.partials,_i=0,_len=_ref.length;_len>_i;_i++)c=_ref[_i],fn=eval(this.partialsPrefix+c),s.partials[c]=new fn({mainView:s.$el,model:s.model,name:c.toLowerCase(),collection:s.collection,active:s.options.tabActive===c.toLowerCase()?!0:!1})},render:function(){var a,b;return b=this,a=b.model.id,$.ajax({url:Q.Accounts.paths.api+"scheda/"+Q.paths.currentpage+"/"+a,beforeSend:function(){b.$el=$("<div>").attr("id","tabScheda-"+a).attr("class","scheda-"+a+" scheda-account tab-pane fade in")},success:function(c){$("#page-content").append(b.$el.html(c)),window.scrollTo(0,100),b.options.viewAccounts.TabMenu.triggerTabClick(a),b.loadPartials()}}),this},load:function(){this.options.viewAccounts.TabMenu.addTabScheda(this.model.id,this),this.render()},removeScheda:function(){delete Q.Accounts.Instances[this.options.el.substring(1)],this.undelegateEvents(),this.$el.removeData().unbind(),this.unbind(),Backbone.View.prototype.remove.call(this),this.collection.unbind(),root=$("#main-container"),root.find(".scheda-"+this.options.uid).detach(),root.find("#tabLista").addClass("fade in"),null!==this&&this.remove()},updateCollection:function(){this.options.viewAccounts.updateDataTable()
}})}),modulejs.define("ViewSchedaNew",["Q","jquery","Backbone"],function(a,b,c){var d;return d=c.View.extend({events:{"submit .form-account-new":"refreshScheda"},initialize:function(){_.bindAll(this,"render","refreshScheda"),this.collection.bind("reset",this.updateCollection,this),this.render()},render:function(){return this},refreshScheda:function(a){var c,d,e;return console.info("refresh scheda"),a.preventDefault(),e=this,d=b(this.el),c=b(".form-account"),b.ajax({url:location.origin+"/qoffice/api/acocunts/salva/"+BetuniQ.Qoffice.page,type:"POST",dataType:"html",data:c.serialize(),success:function(a){3===b(a).length?d.html(a):e.collection.fetch({reset:!0}),e.settings=e.options.tabellaView.OdataTable.fnSettings(),e.response=a}})},updateCollection:function(){var a,c;this.settings.aaData=this.collection.toJSON(),this.options.tabellaView.OdataTable.fnReloadAjax(this.settings),c=b(this.response).find("form").find('input[name="id"]').val(),a=this.options.tabellaView.$el.find('a[href="#'+c+'"]'),this.remove(),this.unbind(),this.collection.unbind(),new BetuniQ.Qoffice.View.SchedaAccountEdit({handlerId:c,handlerTabTitle:a.attr("rel"),tabellaView:this.options.tabellaView.OdataTable,collection:agenzieCollection})}})}),modulejs.define("ViewTabMenuSchede",["Q","jquery","Backbone","ViewSchedaNew"],function(a,b,c,d){var e;return e=c.View.extend({ViewsSchede:[],el:"#tabMenu",events:{"click #nuovo-tab":"schedaNew","click .chiudi-tabscheda":"chiudiScheda"},initialize:function(){_.bindAll(this,"render")},render:function(){},addTabScheda:function(a,b){var c,d;this.$el.find("#scheda-"+a).length,d=document.createDocumentFragment(),c=document.createElement("li"),c.id="scheda-"+a,c.className="scheda-"+a,c.innerHTML='<a href="#tabScheda-'+a+'" data-toggle="tab"><span class="title">'+a+'</span> <span rel="'+a+'" class="chiudi-tabscheda fontello-icon-cancel-circle-3"></span></a>',d.appendChild(c),this.el.appendChild(d),this.ViewsSchede[a]=b},setTabSchedaAsActive:function(a){this.$el.find("#scheda-"+a).siblings().removeClass("active in").end().addClass("active in")},chiudiScheda:function(a){var b;b=a.currentTarget.attributes[0].nodeValue,this.ViewsSchede[b].removeScheda(b)},triggerTabClick:function(a){this.$el.find("#scheda-"+a).find("a").trigger("click")},schedaNew:function(a){new d({el:b(a.currentTarget).find("a").attr("href"),tabellaView:fogliView,collection:this.options.collection})}})}),modulejs.define("initAccounts",["Q","CollectionAccounts","ViewAccounts","ViewSchedaEdit"],function(a,b,c,d){var e,f,g,h;return f=new b,d.prototype.partials=["Scheda","Isolutions","Documenti","Callcenter","Qpoints","Gallery","Assegni","Qshop"],h=new c({collection:f,el:"#lista-"+a.paths.currentpage,dataTableColumns:["uid","idutente","padre","ragione","nome","cognome","comune","provincia","regione","qshop"]}),e=Backbone.Router.extend({initialize:function(){return this.collection=f,this.route(/(.+)/,"schedaAccount"),this.route(/^tab-(.+)$/,"tabAccount"),this},schedaAccount:function(a){return this.listenTo(this.collection,{reset:function(){return h.openAccountTabScheda(a)}})},tabAccount:function(a){return a=a.split("-"),this.listenTo(this.collection,{reset:function(){return h.openAccountTabScheda(a[1],a[0])}})}}),g=new e,Backbone.history.start()}),modulejs.define("initFoglinotizia",["Q","CollectionFoglinotizia","ViewFoglinotizia","ViewSchedaEdit"],function(a,b,c,d){var e;return d.prototype.partials=["Scheda","Isolutions","Documenti","Callcenter","Qpoints","Gallery","Assegni","Qshop"],e=new c({collection:new b,el:"#lista-"+a.paths.currentpage,dataTableColumns:["uid","idutente","padre","ragione","nome","cognome","comune","provincia","regione","qshop"]})}),Q.Accounts={Instances:{},paths:{api:location.origin+"/qoffice/api/accounts/"}},"agenzie"===(_ref=Q.paths.currentpage)||"agenti"===_ref||"poker"===_ref||"utenti"===_ref?modulejs.require("initAccounts"):modulejs.require("initFoglinotizia"),$(function(){return $("#page-content").delegate(".comune","keyup",function(a){var b,c,d;if(!($(this).data("active")||($(".autocomplete-location").addClass("hidden"),d=a.currentTarget.value,c=$(this),b=c.parents(".controls").siblings(".cities-list"),d.length<3)))return b.empty(),$.ajax({url:Q.paths.base+"api/rest/getComune/"+d,beforeSend:function(){c.data("active",!0)},success:function(a){var d,e,f,g,h;for(a=JSON.parse(a),e=document.createDocumentFragment(),g=0,h=a.length;h>g;g++)d=a[g],f=document.createElement("li"),f.className="option_comune",f.setAttribute("data-prov",d.cod_provincia),f.setAttribute("data-istat",d.cod_istat),f.textContent=d.comune,e.appendChild(f);b.append(e).fadeIn(200),c.data("active",!1)}})}),$(document).on("mouseover",".option_comune",function(){return $("form .comune").data("valid","valid").val($(this).text())}),$("#page-content").delegate(".comune","focus",function(){return $(this).val("")}),$("#page-content").delegate(".comune","blur",function(){var a,b,c,d,e;return a=$(".cities-list"),d=$(this),""===d.val()||"valid"!==d.data("valid")?(d.val($(this).attr("title")),$(".autocomplete-location").addClass("hidden").find("input").val(""),a.empty().fadeOut(10),void 0):(e=a.find("li").filter(function(){return $(this).text()===d.val()}),b=e.attr("data-istat"),c=e.attr("data-prov"),$.ajax({url:Q.paths.base+"api/rest/getfulllocations/"+e.text()+"/"+c+"/"+b,success:function(a){var b;a=JSON.parse(a),b=$(".autocomplete-location"),b.removeClass("hidden"),b.find(".provincia").val(a[0].provincia),b.find(".regione").val(a[0].regione),b.find(".cap").val(a[0].cap)}}),a.empty().fadeOut(10))}),$("#btnToggleSidebar").click(function(){return $(this).toggleClass("fontello-icon-resize-full-2 fontello-icon-resize-small-2"),$(this).toggleClass("active"),$("#main-sidebar, #footer-sidebar").animate({width:"toggle"},0),$("body").hasClass("sidebar-hidden")?$("body").removeClass("sidebar-hidden"):$("body").addClass("sidebar-hidden")}),$(window).scroll(function(){return $(this).scrollTop()>100?$("#btnScrollup").fadeIn("slow"):$("#btnScrollup").fadeOut(600)}),$("#btnScrollup").click(function(){return $("html, body").animate({scrollTop:0},500),!1}),$(document).on("click",".chiudi-tabscheda",function(){return $(".scheda-"+$(this).attr("rel")).detach(),$("#lista-tab").find("a").trigger("click"),$("#tabLista").addClass("fade in")}),$("body").delegate('.btn-group > .btn, .btn[data-toggle="button"]',"click",function(){var a;$(this).parent().siblings("#"+$(this).parent().attr("data-target")).val($(this).val()),void 0===$(this).attr("class-toggle")||$(this).hasClass("disabled")||(a=$(this).parent(".btn-group"),"buttons-radio"===a.attr("data-toggle")&&(a.find(".btn").each(function(){return $(this).removeClass($(this).attr("class-toggle"))}),$(this).addClass($(this).attr("class-toggle"))),("buttons-checkbox"===a.attr("data-toggle")||"button"===$(this).attr("data-toggle"))&&($(this).hasClass("active")?$(this).removeClass($(this).attr("class-toggle")):$(this).addClass($(this).attr("class-toggle"))))})})}).call(this);